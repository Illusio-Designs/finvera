# =================================
# FINVERA BACKEND - ENVIRONMENT VARIABLES
# Production Ready Configuration Template
# Copy this file to .env and update with your actual values
# =================================

# =================================
# APPLICATION CONFIGURATION
# =================================
NODE_ENV=production
PORT=3000
APP_NAME=Finvera
LOG_LEVEL=info

# =================================
# DOMAIN CONFIGURATION
# =================================
# Main domain (without protocol) - Used for CORS and OAuth redirects
MAIN_DOMAIN=finvera.solutions

# API domain (backend) - Used for OAuth callbacks
API_DOMAIN=api.finvera.solutions

# Frontend URLs (with protocol)
# The backend will use FRONTEND_URL to determine where to redirect after OAuth
# For client users: client.finvera.solutions
# For admin users: admin.finvera.solutions
FRONTEND_URL=https://client.finvera.solutions

# Optional: Explicitly set CORS origins (auto-configured based on MAIN_DOMAIN if not set)
# CORS_ORIGIN=https://finvera.solutions,https://www.finvera.solutions,https://client.finvera.solutions,https://admin.finvera.solutions

# Note: Backend automatically allows:
# - https://client.finvera.solutions (client portal)
# - https://admin.finvera.solutions (admin portal)
# - https://finvera.solutions (main site)
# - https://www.finvera.solutions (www site)
# - All localhost origins (for development)

# =================================
# DATABASE CONFIGURATION (Main Database)
# =================================
# Main database stores: admin users, distributors, salesmen, system data
DB_HOST=localhost
DB_PORT=3306
DB_USER=finvera_user
DB_PASSWORD=your_secure_db_password_here
DB_NAME=finvera_db

# Master database stores: tenant metadata, companies, shared resources
MASTER_DB_NAME=finvera_master

# Database security - set to 'true' to use separate DB users for each tenant
# If false, all tenant databases use the same credentials
USE_SEPARATE_DB_USERS=false

# =================================
# ENCRYPTION & SECURITY
# =================================
# CRITICAL: Change these in production! Generate strong random keys.
# Use: openssl rand -base64 48 (for 64 character keys)
# Use: openssl rand -hex 32 (for 32 character hex keys)

# ENCRYPTION_KEY: Used for encrypting database passwords (32+ characters, hex recommended)
ENCRYPTION_KEY=your-32-character-secret-key-change-in-production-must-be-32-chars

# PAYLOAD_ENCRYPTION_KEY: Used for API request/response encryption (must match frontend)
PAYLOAD_ENCRYPTION_KEY=your-very-strong-secret-key-at-least-32-characters-long

# JWT Token Configuration
JWT_SECRET=your-jwt-secret-key-change-in-production-min-64-chars
JWT_REFRESH_SECRET=your-jwt-refresh-secret-key-change-in-production-min-64-chars
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# Session Secret for Express Session (used by Passport/Google OAuth)
SESSION_SECRET=your-session-secret-change-in-production-min-64-chars

# =================================
# REDIS CONFIGURATION
# =================================
# Redis is optional but HIGHLY RECOMMENDED for production
# Set REDIS_ENABLED=false if Redis is not available
REDIS_ENABLED=true
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here

# =================================
# GOOGLE OAUTH CONFIGURATION
# =================================
# Required for Google Sign-Up and Login
# Get credentials from: https://console.cloud.google.com/
# 
# IMPORTANT: The callback URL must point to your BACKEND API, not frontend!
# Backend handles OAuth, then redirects to appropriate frontend
#
# For production: Use your API domain
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=https://api.finvera.solutions/api/auth/google/callback
#
# For development/testing:
# GOOGLE_CALLBACK_URL=http://localhost:3000/api/auth/google/callback

# =================================
# RAZORPAY PAYMENT GATEWAY
# =================================
# Required for subscription payments
# Get credentials from: https://dashboard.razorpay.com/
# Set to empty if not using payment gateway
RAZORPAY_KEY_ID=rzp_live_your_key_id
RAZORPAY_KEY_SECRET=your_razorpay_key_secret
RAZORPAY_WEBHOOK_SECRET=your_webhook_secret

# =================================
# EMAIL CONFIGURATION
# =================================
# Set to 'false' to disable email notifications
EMAIL_ENABLED=false
EMAIL_FROM=noreply@finvera.solutions

# Option 1: SMTP Configuration (Nodemailer)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=your-app-password

# Option 2: SendGrid
# SENDGRID_API_KEY=your-sendgrid-api-key

# Option 3: AWS SES
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your-aws-access-key
# AWS_SECRET_ACCESS_KEY=your-aws-secret-key

# =================================
# THIRD-PARTY API INTEGRATIONS
# =================================
# These are optional - used for automatic data fetching and compliance
# Most services use Sandbox API (https://api.sandbox.co.in) as the provider

# E-Invoice API Configuration (Sandbox)
# EINVOICE_API_URL=https://api.sandbox.co.in
# EINVOICE_API_KEY=your-sandbox-api-key

# E-Way Bill API Configuration (Sandbox)
# EWAYBILL_API_URL=https://api.sandbox.co.in
# EWAYBILL_API_KEY=your-sandbox-api-key

# HSN/SAC Code API Configuration (Sandbox)
# HSN_API_URL=https://api.sandbox.co.in
# HSN_API_KEY=your-sandbox-api-key

# GST API Configuration (Sandbox)
# GST_API_URL=https://api.sandbox.co.in
# GST_API_KEY=your-sandbox-api-key

# TDS API Configuration (Sandbox)
# TDS_API_URL=https://api.sandbox.co.in
# TDS_API_KEY=your-sandbox-api-key

# Income Tax API Configuration (Sandbox)
# INCOME_TAX_API_URL=https://api.sandbox.co.in
# INCOME_TAX_API_KEY=your-sandbox-api-key

# =================================
# FINBOX API (Optional - for financial insights)
# =================================
# FINBOX_API_URL=https://api.finbox.in
# FINBOX_INSIGHTS_API_URL=https://insights.finbox.in
# FINBOX_API_KEY=your-finbox-api-key

# =================================
# FILE UPLOAD CONFIGURATION
# =================================
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760
MAX_DSC_CERTIFICATE_SIZE=5242880

# =================================
# CORS CONFIGURATION (Optional - Auto-configured)
# =================================
# Uncomment if you need custom CORS origins
# CORS_ORIGIN=https://yourdomain.com,https://admin.yourdomain.com

# =================================
# ADDITIONAL SECURITY SETTINGS
# =================================
# Rate limiting (requests per 15 minutes per IP)
# RATE_LIMIT_WINDOW_MS=900000
# RATE_LIMIT_MAX=100

# =================================
# DEVELOPMENT SETTINGS (Remove in Production)
# =================================
# Uncomment these only for development/debugging
# DEBUG=true
# DISABLE_SSL_VERIFICATION=false
# ENABLE_QUERY_LOGGING=false

# =================================
# PRODUCTION DEPLOYMENT CHECKLIST
# =================================
# 
# REQUIRED (Must be configured):
# âœ… All database credentials (DB_HOST, DB_USER, DB_PASSWORD, etc.)
# âœ… All encryption keys (ENCRYPTION_KEY, PAYLOAD_ENCRYPTION_KEY)
# âœ… All JWT secrets (JWT_SECRET, JWT_REFRESH_SECRET, SESSION_SECRET)
# âœ… MAIN_DOMAIN and FRONTEND_URL
# âœ… NODE_ENV=production
# 
# HIGHLY RECOMMENDED:
# âš ï¸ Redis configuration (for session management and caching)
# âš ï¸ Google OAuth (GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET)
# âš ï¸ Razorpay (for payment processing)
# âš ï¸ Email service (for notifications)
# 
# OPTIONAL (Enable as needed):
# ðŸ“Œ Third-party API integrations (E-Invoice, GST, TDS, etc.)
# ðŸ“Œ Finbox API (for financial analytics)
# 
# SECURITY CHECKLIST:
# ðŸ”’ Change ALL default secrets and keys
# ðŸ”’ Use strong random strings (minimum 32 characters for keys, 64 for secrets)
# ðŸ”’ Never commit .env file to version control
# ðŸ”’ Use environment-specific .env files
# ðŸ”’ Enable SSL/TLS for all connections
# ðŸ”’ Set NODE_ENV=production
# ðŸ”’ Configure firewall rules for database access
# ðŸ”’ Use separate database users for each tenant (if needed)
# ðŸ”’ Regularly rotate encryption keys (with proper migration)
# 
# =================================
# SETUP INSTRUCTIONS
# =================================
# 
# DATABASE SETUP:
# 1. Create MySQL user:
#    CREATE USER 'finvera_user'@'localhost' IDENTIFIED BY 'your_password';
# 2. Grant privileges:
#    GRANT ALL PRIVILEGES ON finvera_*.* TO 'finvera_user'@'localhost';
#    FLUSH PRIVILEGES;
# 3. Run migrations: npm run migrate
# 4. Run seeders: npm run seed
# 
# REDIS SETUP:
# 1. Install Redis: apt-get install redis-server (Ubuntu/Debian)
#    or: brew install redis (macOS)
# 2. Configure Redis password in /etc/redis/redis.conf:
#    requirepass your_redis_password
# 3. Restart Redis: systemctl restart redis (Linux) or brew services restart redis (macOS)
# 4. Test connection: redis-cli -a your_redis_password ping
# 
# GOOGLE OAUTH SETUP:
# 1. Go to: https://console.cloud.google.com/
# 2. Create new project or select existing
# 3. Enable Google+ API and Google OAuth 2.0
# 4. Create OAuth 2.0 credentials (Web application)
# 5. Add authorized redirect URIs:
#    - https://api.finvera.solutions/api/auth/google/callback (production)
#    - http://localhost:3000/api/auth/google/callback (development)
# 6. Copy Client ID and Client Secret to this file
# 
# RAZORPAY SETUP:
# 1. Sign up at: https://dashboard.razorpay.com/
# 2. Get API keys from Settings > API Keys
# 3. Set up webhook: Settings > Webhooks
# 4. Webhook URL: https://api.finvera.solutions/api/razorpay/webhook
# 5. Copy webhook secret to this file
# 
# GENERATE SECURE KEYS:
# For 32-character hex key: openssl rand -hex 32
# For 64-character base64 secret: openssl rand -base64 48
# For JWT secrets (64+ chars): openssl rand -base64 64
# 
# =================================
# SERVER DEPLOYMENT STEPS
# =================================
# 1. Copy this file: cp .env.example .env
# 2. Edit .env with your production values: nano .env
# 3. Install dependencies: npm install --production
# 4. Create upload directories: mkdir -p uploads logs
# 5. Set permissions: chmod 777 uploads logs
# 6. Run migrations: npm run migrate
# 7. Run seeders: npm run seed
# 8. Start with PM2: pm2 start server.js --name finvera-backend --node-args="--max-old-space-size=4096 --expose-gc"
# 9. Save PM2: pm2 save
# 10. Verify: curl http://localhost:3000/health
# 
# =================================
